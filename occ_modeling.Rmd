---
title: "Occupancy Models"
author: "Andy"
date: "2/15/2022"
output: html_document
---

Now that we have a working temperature model, let's play with occupancy models. First issue will be to determine detection probability for our two taxa of interest, dragonflies and mosquitoes.


```{r, echo = FALSE}
library(unmarked)
library(AICcmodavg)
occupancy.df <- read.csv("occ2021_reformat.csv")
occupancy.df <- occupancy.df[rowSums(is.na(occupancy.df[,3:10])) != 8, ]
occupancy.df$Pool_ID <- as.factor(occupancy.df$ï..Pool_ID)
occupancy.df$ï..Pool_ID <- NULL
occupancy.df$JulianDate <- as.factor(occupancy.df$JulianDate)

# Get data merged and ready for unmarked:
abiotic.df <- read.csv("temp_predictions.csv")
abiotic.df$Pool_ID <- as.factor(abiotic.df$Pool_ID)
abiotic2.df <- read.csv("abiotic_data.csv")
abiotic2.df$Pool_ID <- as.factor(abiotic2.df$Pool_ID)
occupancy.df <- merge(occupancy.df, abiotic.df, by.x = "Pool_ID", by.y = "Pool_ID")
occupancy.df <- merge(occupancy.df, abiotic2.df, by.x = "Pool_ID", by.y = "Pool_ID")
occupancy.df$Notes <- NULL
occupancy.df$Pct_Shaded.y <- NULL
occupancy.df$Depth_cm.y <- NULL
occupancy.df$lat.x <- NULL
occupancy.df$long.x <- NULL
occupancy.df$lat.y <- NULL
occupancy.df$long.y <- NULL
occupancy.df$DistRC_m <- as.numeric(occupancy.df$DistRC_m)
occupancy.df$SurfArea_cm2 <- as.numeric(occupancy.df$SurfArea_cm2)
occupancy.df$Volume_cm3 <- as.numeric(occupancy.df$Volume_cm3)
names(occupancy.df)[names(occupancy.df) == 'Depth_cm.x'] <- 'Depth_cm'
names(occupancy.df)[names(occupancy.df) == 'Pct_Shaded.x'] <- 'Pct_Shaded'
occupancy.df <- occupancy.df[-c(1371:1390),] # Dropping these for now because they don't have dist to river channel
occupancy.df$logSurfArea <- log(occupancy.df$SurfArea_cm2)
occupancy.df$logDepth <- log(occupancy.df$Depth_cm)
occupancy.df$logVol <- log(occupancy.df$Volume_cm3)

library(GGally)
pairs.df <- subset(occupancy.df, select = c("mosq_a", "dfly_a", "logDepth", "Pct_Shaded", "logSurfArea", "Temp_Zscore", "DistRC_m", "logVol")) 
ggpairs(data = pairs.df)
# Mosquitoes correlate with volume, surface area, depth, and temperature
# Dragons correlate with volume, surface area, depth, dist to river channel, and shading

# Some of these variables overlap and/or are collinear, especially the dimensions
# Shading correlates with both distance to river channel and temperature, so let's drop it
# From the perspective of aerial colonizers, surface area is likely to be more important than depth or volume, so let's drop both
# Problem is that surface area is also correlated with temperature here... hmm. Maybe that's why the interaction term works.

# So, that leaves us with mosquitoes as a function of surface area and temperature, and dragons as a function of surface area and distance to RC

occupancy.df <- subset(occupancy.df, select = c("Pool_ID", "JulianDate", "mosq_a", "mosq_b", "mosq_c", "mosq_d", "dfly_a", "dfly_b", "dfly_c", "dfly_d", "Temp_Zscore", "Temp_Predicted_C", "Temp_StdErr", "DistRC_m", "logSurfArea"))
```


```{r, echo = FALSE, warning = FALSE}
# Grabbing pool level covariates
siteCovs <- as.data.frame(occupancy.df[c(1:2, 11:15)])

# Specify matrices of occ data, then make it into an unmarked dataframe
sp1 <- as.matrix(occupancy.df[c(3:6)])
sp2 <- as.matrix(occupancy.df[c(7:10)])

y <- list(sp1, sp2)

umf <- unmarkedFrameOccuMulti(y = y, siteCovs = siteCovs, obsCovs = NULL)
```

```{r, echo = FALSE, warning = FALSE}
# According to Josh, Julian date can be considered a detection covariate, because abundance of either spp. probably varies in time, and that could affect our ability to detect them
cand.models <- list()

# First, the full model
# We'll assume that the probability of both occurring might have something to do with the variables that determine their occupancy
stateformulas <- c('~Temp_Zscore * logSurfArea', '~DistRC_m + logSurfArea', '~Temp_Zscore * logSurfArea + DistRC_m')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[1]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Now let's do some combo models
```

```{r, echo = FALSE, warning = FALSE}
## Drop SA from mosquitoes and overlap models
stateformulas <- c('~Temp_Zscore', '~DistRC_m + logSurfArea', '~Temp_Zscore + logSurfArea + DistRC_m')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[2]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop SA from mosquitoes and RC from dragons
stateformulas <- c('~Temp_Zscore', '~logSurfArea', '~Temp_Zscore + logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[3]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop SA from mosquitoes and SA from dragons
stateformulas <- c('~Temp_Zscore', '~DistRC_m', '~Temp_Zscore + DistRC_m')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[4]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop SA from mosquitoes and both from dragons
stateformulas <- c('~Temp_Zscore', '~1', '~Temp_Zscore')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[5]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)
```

```{r, echo = FALSE, warning = FALSE}
## Drop temperature from the mosquito and overlap models
stateformulas <- c('~logSurfArea', '~DistRC_m + logSurfArea', '~logSurfArea + DistRC_m')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[6]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop SA from dragons
stateformulas <- c('~logSurfArea', '~DistRC_m', '~logSurfArea + DistRC_m')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[7]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop DistRC_m from dragons
stateformulas <- c('~logSurfArea', '~logSurfArea', '~logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[8]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop both from dragons
stateformulas <- c('~logSurfArea', '~1', '~logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[9]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)
```

```{r, echo = FALSE, warning = FALSE}
## Drop both terms from mosquito and overlap model
stateformulas <- c('~1', '~DistRC_m + logSurfArea', '~logSurfArea + DistRC_m')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[10]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop DistRC_m from dragon model
stateformulas <- c('~1', '~logSurfArea', '~logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[11]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop logSurfArea from dragon model
stateformulas <- c('~1', '~DistRC_m', '~DistRC_m')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[12]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop both
stateformulas <- c('~1', '~1', '~1')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[13]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)
```

```{r, echo = FALSE, warning = FALSE}
### All of the above, with a null expectation for the overlap model

## Drop SA from mosquitoes and overlap models
stateformulas <- c('~Temp_Zscore', '~DistRC_m + logSurfArea', '~1')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[14]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop SA from mosquitoes and RC from dragons
stateformulas <- c('~Temp_Zscore', '~logSurfArea', '~1')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[15]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop SA from mosquitoes and SA from dragons
stateformulas <- c('~Temp_Zscore', '~DistRC_m', '~1')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[16]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop SA from mosquitoes and both from dragons
stateformulas <- c('~Temp_Zscore', '~1', '~1')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[17]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)


## Drop temperature from the mosquito and overlap models
stateformulas <- c('~logSurfArea', '~DistRC_m + logSurfArea', '~1')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[18]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop SA from dragons
stateformulas <- c('~logSurfArea', '~DistRC_m', '~1')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[19]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop DistRC_m from dragons
stateformulas <- c('~logSurfArea', '~logSurfArea', '~1')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[20]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop both from dragons
stateformulas <- c('~logSurfArea', '~1', '~1')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[21]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

## Drop both terms from mosquito and overlap model
stateformulas <- c('~1', '~DistRC_m + logSurfArea', '~1')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[22]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop DistRC_m from dragon model
stateformulas <- c('~1', '~logSurfArea', '~1')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[23]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop logSurfArea from dragon model
stateformulas <- c('~1', '~DistRC_m', '~1')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[24]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

```

```{r, echo = FALSE, warning = FALSE}
### All of the above, but assuming overlap is driven by mosquito terms ONLY
## Drop SA from mosquitoes and overlap models
stateformulas <- c('~Temp_Zscore', '~DistRC_m + logSurfArea', '~Temp_Zscore')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[25]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop SA from mosquitoes and RC from dragons
stateformulas <- c('~Temp_Zscore', '~logSurfArea', '~Temp_Zscore')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[26]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop SA from mosquitoes and SA from dragons
stateformulas <- c('~Temp_Zscore', '~DistRC_m', '~Temp_Zscore')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[27]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop SA from mosquitoes and both from dragons
stateformulas <- c('~Temp_Zscore', '~1', '~Temp_Zscore')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[28]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)


## Drop temperature from the mosquito and overlap models
stateformulas <- c('~logSurfArea', '~DistRC_m + logSurfArea', '~logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[29]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop SA from dragons
stateformulas <- c('~logSurfArea', '~DistRC_m', '~logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[30]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop DistRC_m from dragons
stateformulas <- c('~logSurfArea', '~logSurfArea', '~logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[31]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop both from dragons
stateformulas <- c('~logSurfArea', '~1', '~logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[32]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

```

```{r, echo = FALSE, warning = FALSE}
### All of the above, but assuming overlap is driven by dragonfly terms ONLY

## Drop SA from mosquitoes model
stateformulas <- c('~Temp_Zscore', '~DistRC_m + logSurfArea', '~DistRC_m + logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[33]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop SA from mosquitoes and RC from dragons
stateformulas <- c('~Temp_Zscore', '~logSurfArea', '~logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[34]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop SA from mosquitoes and SA from dragons
stateformulas <- c('~Temp_Zscore', '~DistRC_m', '~DistRC_m')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[35]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)


## Drop temperature from the mosquito models
stateformulas <- c('~logSurfArea', '~DistRC_m + logSurfArea', '~DistRC_m + logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[36]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop SA from dragons
stateformulas <- c('~logSurfArea', '~DistRC_m', '~DistRC_m')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[37]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop DistRC_m from dragons
stateformulas <- c('~logSurfArea', '~logSurfArea', '~logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[38]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

## Drop both terms from mosquito and overlap model
stateformulas <- c('~1', '~DistRC_m + logSurfArea', '~DistRC_m + logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[39]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop DistRC_m from dragon model
stateformulas <- c('~1', '~logSurfArea', '~logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[40]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# Drop logSurfArea from dragon model
stateformulas <- c('~1', '~DistRC_m', '~DistRC_m')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[41]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)
```

```{r, echo = FALSE, warning = FALSE}
## Only missing models are ones where the overlap model includes combinations of some (but not all) terms from both, e.g.

# From the full model
stateformulas <- c('~Temp_Zscore * logSurfArea', '~DistRC_m + logSurfArea', '~Temp_Zscore * logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[42]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)


stateformulas <- c('~Temp_Zscore * logSurfArea', '~DistRC_m + logSurfArea', '~Temp_Zscore + DistRC_m')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[43]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)


stateformulas <- c('~Temp_Zscore * logSurfArea', '~DistRC_m + logSurfArea', '~DistRC_m + logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[44]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

stateformulas <- c('~Temp_Zscore * logSurfArea', '~DistRC_m + logSurfArea', '~logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[45]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

stateformulas <- c('~Temp_Zscore * logSurfArea', '~DistRC_m + logSurfArea', '~DistRC_m')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[46]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

stateformulas <- c('~Temp_Zscore * logSurfArea', '~DistRC_m + logSurfArea', '~Temp_Zscore')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[47]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# From a model that drops temperature from mosquitoes
stateformulas <- c('~logSurfArea', '~DistRC_m + logSurfArea', '~logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[48]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

stateformulas <- c('~logSurfArea', '~DistRC_m + logSurfArea', '~DistRC_m')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[49]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# From a model that drops temperature and surface area from mosquitoes
stateformulas <- c('~1', '~DistRC_m + logSurfArea', '~logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[50]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

stateformulas <- c('~1', '~DistRC_m + logSurfArea', '~DistRC_m')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[51]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# From a model that drops surface area from mosquitoes
stateformulas <- c('~Temp_Zscore', '~DistRC_m + logSurfArea', '~Temp_Zscore + logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[52]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

stateformulas <- c('~Temp_Zscore', '~DistRC_m + logSurfArea', '~Temp_Zscore + DistRC_m')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[53]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

stateformulas <- c('~Temp_Zscore', '~DistRC_m + logSurfArea', '~DistRC_m')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[54]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

stateformulas <- c('~Temp_Zscore * logSurfArea', '~DistRC_m + logSurfArea', '~logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[55]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# From a model that drops DistRC_m from dragons
stateformulas <- c('~Temp_Zscore * logSurfArea', '~logSurfArea', '~Temp_Zscore')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[56]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# From a model that drops surface area from dragons
stateformulas <- c('~Temp_Zscore * logSurfArea', '~DistRC_m', '~logSurfArea + DistRC_m')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[57]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

stateformulas <- c('~Temp_Zscore * logSurfArea', '~DistRC_m', '~Temp_Zscore + DistRC_m')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[58]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

# From a model that drops both from dragons
stateformulas <- c('~Temp_Zscore * logSurfArea', '~1', '~Temp_Zscore')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[59]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)

stateformulas <- c('~Temp_Zscore * logSurfArea', '~1', '~logSurfArea')
detformulas <- c('~JulianDate', '~JulianDate')

cand.models[[60]] <- occuMulti(stateformulas = stateformulas,
                  detformulas = detformulas,
             data = umf,
             se = TRUE)
```

```{r}
## Compare models
mod.names <- paste("mod", 1:length(cand.models), sep = " " )
aictab(cand.set = cand.models, modnames = mod.names, sort = TRUE)
```

```{r}
## Top performing models:
summary(cand.models[[19]]) # Didn't converge, or it has NaNs somewhere weird
summary(cand.models[[37]]) # Mossies as a function of surface area, dragons as a function of river channel, river channel for both but n.s.
summary(cand.models[[30]]) # More NaNs
summary(cand.models[[18]]) # Ditto
summary(cand.models[[7]])

# None of the top performing models have temperature. Hmmmm.
summary(cand.models[[7]])
summary(cand.models[[49]])
summary(cand.models[[29]])
summary(cand.models[[48]])
summary(cand.models[[57]]) # This is the first one that does, and it's still not significant (p = 0.086)
# It includes temperature (n.s.), surface area, and their overlap (n.s.) for mossies; dist to river channel for dragons; surf area and RC for overlap (but n.s.)
```

```{r, eval = FALSE, echo = FALSE}
predicted.fit <- predict(cand.models[[57]], type='state')
predicted.vals <- as.data.frame(predicted.fit[1])
predicted.vals <- cbind(predicted.vals, siteCovs)
plot(x = predicted.vals$Temp_Predicted_C, y = predicted.vals$Predicted.psi.10.)
plot(x = predicted.vals$logSurfArea, y = predicted.vals$Predicted.psi.10.)
plot(x = predicted.vals$DistRC_m, y = predicted.vals$Predicted.psi.01.)

# What's mean occupancy of all three states?
mean(predicted.vals$Predicted.psi.10.) # 50.0% chance a pool had mosquitoes. Whoa!
mean(predicted.vals$Predicted.psi.01.) # Only a 16.2% chance of dragons.
mean(predicted.vals$Predicted.psi.11.) # Only 3.8% chance of both co-occurring. This is less than half of what would be expected based on random chance from the above probabilities (~8.1%). 


# So if this model is correct, dragons go wherever in the landscape regardless of temperature but seem to occur more often closer to the river channel, while mosquitoes seem to prefer warmer, smaller pools. The presence of dragons reduces the likelihood of mosquitoes being present but is otherwise hard to predict.
```


A couple of alternate approaches: Use the 9-sweep data, and model mosquito abundance as a function of dragonfly abundance + other covariates.

Or, try a simple logistic model of mosquito presence/absence.

How to handle surface area and temperature colinearity? The equivalent model to the best that includes temperature (mod57) that also excludes surface area for mosquitoes (mod4) has a dAIC of 112.49 which is pretty poor.

Also to do: 

How does one directly analyze whether spp. B affects spp. A's distribution? Some variety of goodness of fit test, like a chi-squared? See also Rota et al. 2016.

Ask Josh also how he makes his figures.